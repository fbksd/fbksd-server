# FBKSD Server Utilities 

## fbksd-ci

Runs inside the CI build container.
Communicates with the `fbksd-server` via a TCP socket connection.
Has access to some mounted volumes with read-only permission (scenes, renderers, metrics),
and read/write permission (temporary workspace for running the benchmark).

## fbksd-server

Runs permanently in a service container and exposes the port `fbksd-ci` connects to.
Has access to mounted volumes from the host containing all data related to the service, with read/write permission.

## fbksd-ctl

Runs directly in the host machine. Use for management-related tasks.

## Data layout

```txt
<root>
├── registry.json
├── scenes/       (full scenes for rendering)
├── renderers/    (full renderers for rendering)
├── iqa/    (full iqa metrics for benchmarking)
├── results
│   ├── denoisers
│   │   ├── <proj id>
│   │   │   ├── published  ->  <published workspace folder> 
│   │   │   ├── 16fdc032-7d80-4ea9-b535-2d621509e7df/    (technique's result folder from a run)
│   │   │   │   ├── info.json  (technique's info.json from commit that fired the run)
│   │   │   │   └── default
│   │   │   │       ├── <scene 1>/
│   │   │   │       └── ...
│   │   │   └── ...
│   │   └── ...
│   └── samplers/ (similar to "results/denoisers")
├── public  (this folder is totally self-contained - no links to places outside of it)
│   ├── scenes/
│   ├── data/
│   ├── index.html
│   ├── 16fdc032-7d80-4ea9-b535-2d621509e7df  (exported from a technique)
│   │   ├── scenes  ->  ../scenes
│   │   ├── data    -> 
│   │   │   ├── denoisers
│   │   │   │   ├── Box  -> ../../../data/denoisers/Box
│   │   │   │   └── <this technique> 
│   │   │   ├── samplers -> ../../data/samplers
│   │   ├── index.html
```

# File permissions

`fbksd-ci` runs with the `fbksd-ci:fbksd-ci` ownership.
`fbksd-server` runs with the `fbksd:fbksd` ownership.
The `fbksd` user is in the `fbksd-ci` group, so it can manage the results.

The user `gitlab-www` is in the `fbksd-ci` group, so it can serve the results generated by the techniques.